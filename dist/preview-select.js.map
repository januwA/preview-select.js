{"version":3,"file":"preview-select.js","sources":["../src/mask.ts","../src/utils.ts","../src/preview-node.ts","../src/preview-select.ts"],"sourcesContent":["interface MaskOptions {\r\n  duration?: number;\r\n  background?: string;\r\n}\r\n\r\nexport class Mask {\r\n  /**\r\n   * * 遮罩层的z-index\r\n   */\r\n  static zIndex = 1300;\r\n\r\n  /**\r\n   * * Maks的dom节点\r\n   */\r\n  private div: HTMLElement = document.createElement(\"div\");\r\n\r\n  /**\r\n   * * 是否为打开状态\r\n   */\r\n  public isOpen: boolean = false;\r\n\r\n  /**\r\n   * * 动画时间\r\n   */\r\n  public duration?: number;\r\n\r\n  /**\r\n   * * mask的背景颜色\r\n   */\r\n  public background?: string;\r\n\r\n  constructor(options: MaskOptions) {\r\n    if (options) {\r\n      const { duration, background } = options;\r\n      this.duration = duration;\r\n      this.background = background;\r\n    }\r\n    if (!this.background) this.background = \"rgba(0, 0, 0, .5)\";\r\n    this.setup();\r\n  }\r\n\r\n  private setup() {\r\n    this.div.style.cssText = `\r\n        position: fixed;\r\n        left: 0;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        height: 100vh;\r\n        overflow: hidden;\r\n        background: ${this.background};\r\n        z-index: ${Mask.zIndex};\r\n        transition: opacity 1s ease 0s;\r\n  `;\r\n    this.hide();\r\n    document.body.append(this.div);\r\n    this.div.addEventListener(\"click\", () => this.toggle());\r\n  }\r\n\r\n  private closeEvent!: Function;\r\n\r\n  /**\r\n   * * 显示mask\r\n   */\r\n  hide() {\r\n    this.isOpen = false;\r\n    this.div.style.opacity = \"0\";\r\n    setTimeout(() => {\r\n      this.div.style.width = \"0px\";\r\n    }, this.duration);\r\n    if (this.closeEvent) this.closeEvent();\r\n  }\r\n\r\n  private openEvent!: Function;\r\n  /**\r\n   * * 隐藏mask\r\n   */\r\n  open() {\r\n    this.isOpen = true;\r\n    this.div.style.width = \"100%\";\r\n    this.div.style.opacity = \"1\";\r\n    if (this.openEvent) this.openEvent();\r\n  }\r\n\r\n  toggle() {\r\n    if (!this.isOpen) {\r\n      this.open();\r\n    } else {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * * 监听mask的关闭事件\r\n   * @param fn\r\n   */\r\n  closeEventListener(fn: Function) {\r\n    if (fn) {\r\n      this.closeEvent = fn;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * * 监听mask的打开事件\r\n   * @param fn\r\n   */\r\n  openEventListener(fn: Function) {\r\n    if (fn) {\r\n      this.openEvent = fn;\r\n    }\r\n  }\r\n}\r\n","export function getPV(el: HTMLElement, prop: string) {\r\n  return document\r\n    .defaultView!.getComputedStyle(el, null)\r\n    .getPropertyValue(prop);\r\n}\r\n\r\nexport function createCSSStyleDeclaration(): CSSStyleDeclaration {\r\n  return document.createElement(\"div\").style;\r\n}\r\n\r\nexport function setBodyOverflowHidden(hidden: boolean): void {\r\n  // TODO: 滚动条的显示或隐藏，将会引起页面的\"跳动\"，暂时不处理\r\n  // document.body.style.overflow = hidden ? \"hidden\" : \"auto\";\r\n}\r\n","import { Mask } from \"./mask\";\r\nimport {\r\n  createCSSStyleDeclaration,\r\n  setBodyOverflowHidden,\r\n  getPV\r\n} from \"./utils\";\r\nimport { PreviewSelect } from \"./preview-select\";\r\n\r\ninterface PreviewEvent {\r\n  (node: PreviewNode): void;\r\n}\r\nexport class PreviewNode {\r\n  static zIndex = Mask.zIndex + 1;\r\n  private isOpen: boolean = false;\r\n  private oldProp: CSSStyleDeclaration;\r\n\r\n  constructor(\r\n    public node: HTMLElement,\r\n    public duration: number,\r\n    private transition: string\r\n  ) {\r\n    node.addEventListener(\"click\", () => this.handle());\r\n    this.oldProp = createCSSStyleDeclaration();\r\n  }\r\n\r\n  private handle() {\r\n    if (this.isOpen) {\r\n      this.reset();\r\n      PreviewSelect.mask.hide();\r\n    } else {\r\n      this.preview();\r\n      PreviewSelect.mask.open();\r\n    }\r\n  }\r\n\r\n  private previewEvent!: PreviewEvent;\r\n  /**\r\n   * 开始执行动画时的监听事件\r\n   * @param fn\r\n   */\r\n  previewEventListener(fn: PreviewEvent) {\r\n    this.previewEvent = fn;\r\n  }\r\n\r\n  reset() {\r\n    this.isOpen = false;\r\n    const [oldPosition, oldZIndex, oldTransition] = [\r\n      this.oldProp.removeProperty(\"position\"),\r\n      this.oldProp.removeProperty(\"zIndex\"),\r\n      this.oldProp.removeProperty(\"transition\")\r\n    ];\r\n    const [currentPosition, currentZIndex, Currenttransition] = [\r\n      this.node.style.position,\r\n      this.node.style.zIndex,\r\n      this.node.style.transition\r\n    ];\r\n    this.node.style.cssText = this.oldProp.cssText;\r\n    this.node.style.position = currentPosition;\r\n    this.node.style.zIndex = currentZIndex;\r\n    this.node.style.transition = Currenttransition;\r\n\r\n    setTimeout(() => {\r\n      this.node.style.position = oldPosition;\r\n      this.node.style.zIndex = oldZIndex;\r\n      this.node.style.transition = oldTransition;\r\n      setBodyOverflowHidden(false);\r\n    }, this.duration);\r\n  }\r\n  preview() {\r\n    if (this.previewEvent) this.previewEvent(this);\r\n    const target = this.node;\r\n    this.oldProp.cssText = target.style.cssText;\r\n\r\n    target.style.transition = this.transition;\r\n\r\n    target.style.position = \"relative\";\r\n    target.style.zIndex = PreviewNode.zIndex.toString();\r\n\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n    const w = parseFloat(getPV(target, \"width\"));\r\n    const h = parseFloat(getPV(target, \"height\"));\r\n    let x = width / 2 - w / 2 - target.offsetLeft + window.scrollX;\r\n    let y = height / 2 - h / 2 - target.offsetTop + window.scrollY;\r\n    target.style.transform = `translate(${x}px , ${y}px )`;\r\n\r\n    if (PreviewSelect.toStyle) {\r\n      for (const key in PreviewSelect.toStyle) {\r\n        const value = PreviewSelect.toStyle[key].toString();\r\n        // 避免[transform]属性的冲突\r\n        if (key === \"transform\") target.style[key] += value;\r\n        else target.style[key] = value;\r\n      }\r\n    }\r\n\r\n    setBodyOverflowHidden(true);\r\n    this.isOpen = true;\r\n  }\r\n}\r\n","import { Mask } from \"./mask\";\r\nimport { PreviewNode } from \"./preview-node\";\r\n\r\ninterface PreviewSelectOptions {\r\n  select: string;\r\n  curve?: string;\r\n  duration?: number;\r\n  mask?: Mask;\r\n}\r\n\r\nexport class PreviewSelect {\r\n  static mask: Mask;\r\n\r\n  static toStyle: CSSStyleDeclaration;\r\n\r\n  /**\r\n   * * 动画的持续时间, 毫秒为单位\r\n   * * default [1000]\r\n   */\r\n  public duration: number = 1000;\r\n\r\n  /**\r\n   * * 当前执行动画的元素\r\n   */\r\n  public curent!: PreviewNode;\r\n\r\n  /**\r\n   * * 所有需要监听的元素\r\n   */\r\n  public nodes: HTMLElement[];\r\n\r\n  /**\r\n   * * 动画曲线\r\n   * * default [ease]\r\n   */\r\n  public curve: string = \"ease\";\r\n\r\n  constructor({\r\n    select,\r\n    duration,\r\n    curve,\r\n    mask = new Mask({})\r\n  }: PreviewSelectOptions) {\r\n    if (duration) this.duration = duration;\r\n    if (curve) this.curve = curve;\r\n    this.nodes = Array.from<HTMLElement>(\r\n      document.querySelectorAll<HTMLElement>(select)\r\n    );\r\n    mask.duration = duration;\r\n    PreviewSelect.mask = mask;\r\n    this.setup();\r\n  }\r\n\r\n  private setup(): void {\r\n    const self = this;\r\n    PreviewSelect.mask.closeEventListener(() => {\r\n      if (self.curent) self.curent.reset();\r\n    });\r\n\r\n    for (const node of this.nodes) {\r\n      new PreviewNode(\r\n        node,\r\n        this.duration,\r\n        `all ${this.duration}ms ${this.curve} 0s`\r\n      ).previewEventListener(node => {\r\n        this.curent = node;\r\n      });\r\n    }\r\n  }\r\n\r\n  public to(style: CSSStyleDeclaration): PreviewSelect {\r\n    PreviewSelect.toStyle = style;\r\n    return this;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}