{"version":3,"file":"preview-select.js","sources":["../src/preview-select.ts"],"sourcesContent":["interface StartCB {\r\n  (node: PreviewNode): void;\r\n}\r\ninterface PreviewSelectOptions {\r\n  select: string;\r\n}\r\nfunction getPV(el: HTMLElement, prop: string) {\r\n  return document\r\n    .defaultView!.getComputedStyle(el, null)\r\n    .getPropertyValue(prop);\r\n}\r\n\r\nclass Mask {\r\n  static zIndex = 1300;\r\n  isHide = true;\r\n\r\n  div!: HTMLElement;\r\n\r\n  constructor() {\r\n    this.setup();\r\n  }\r\n\r\n  setup() {\r\n    this.div = document.createElement(\"div\");\r\n    this.div.style.cssText = `\r\n        position: fixed;\r\n        left: 0;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        width: 0px;\r\n        height: 100vh;\r\n        overflow: hidden;\r\n        background: rgba(0, 0, 0, 0.3);\r\n        z-index: ${Mask.zIndex};\r\n        transition: opacity 1s ease 0s;\r\n    `;\r\n    this.hide();\r\n    document.body.append(this.div);\r\n    this.div.addEventListener(\"click\", () => this.toggle());\r\n  }\r\n\r\n  closeEvent!: Function;\r\n  hide() {\r\n    this.isHide = true;\r\n    this.div.style[\"opacity\"] = \"0\";\r\n    setTimeout(() => {\r\n      this.div.style[\"width\"] = \"0px\";\r\n      document.body.style[\"overflow\"] = \"auto\";\r\n    }, 1000);\r\n    if (this.closeEvent) this.closeEvent();\r\n  }\r\n\r\n  openEvent!: Function;\r\n  open() {\r\n    document.body.style[\"overflow\"] = \"hidden\";\r\n    this.isHide = false;\r\n    this.div.style[\"opacity\"] = \"1\";\r\n    this.div.style[\"width\"] = \"100vw\";\r\n    if (this.openEvent) this.openEvent();\r\n  }\r\n\r\n  toggle() {\r\n    if (this.isHide) {\r\n      this.open();\r\n    } else {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  closeEventListener(fn: Function) {\r\n    if (fn) {\r\n      this.closeEvent = fn;\r\n    }\r\n  }\r\n\r\n  openEventListener(fn: Function) {\r\n    if (fn) {\r\n      this.openEvent = fn;\r\n    }\r\n  }\r\n}\r\n\r\nexport class PreviewSelect {\r\n  static mask: Mask;\r\n  static toStyle: CSSStyleDeclaration;\r\n\r\n  public curent!: PreviewNode;\r\n\r\n  public nodes: HTMLElement[];\r\n\r\n  constructor({ select }: PreviewSelectOptions) {\r\n    this.nodes = Array.from<HTMLElement>(\r\n      document.querySelectorAll<HTMLElement>(select)\r\n    );\r\n\r\n    this.setup();\r\n  }\r\n\r\n  private setup(): void {\r\n    PreviewSelect.mask = new Mask();\r\n    const self = this;\r\n    PreviewSelect.mask.closeEventListener(() => {\r\n      if (self.curent) self.curent.resize();\r\n    });\r\n\r\n    for (const node of this.nodes) {\r\n      new PreviewNode(node).start(node => {\r\n        this.curent = node;\r\n      });\r\n    }\r\n  }\r\n\r\n  public to(style: CSSStyleDeclaration): PreviewSelect {\r\n    let div = document.createElement(\"div\");\r\n    for (const key in style) {\r\n      const element = style[key];\r\n      div.style[key] = element.toString();\r\n    }\r\n    PreviewSelect.toStyle = div.style;\r\n    return this;\r\n  }\r\n}\r\n\r\nclass PreviewNode {\r\n  static zIndex = Mask.zIndex + 1;\r\n  private isOpen: boolean = false;\r\n  private oldProp: CSSStyleDeclaration;\r\n\r\n  constructor(public node: HTMLElement) {\r\n    node.addEventListener(\"click\", () => this.handle());\r\n    this.oldProp = document.createElement(\"div\").style;\r\n  }\r\n\r\n  private handle() {\r\n    if (this.isOpen) {\r\n      this.resize();\r\n      PreviewSelect.mask.hide();\r\n    } else {\r\n      this.animeted();\r\n      PreviewSelect.mask.open();\r\n    }\r\n  }\r\n\r\n  private startCB!: StartCB;\r\n  start(fn: StartCB) {\r\n    this.startCB = fn;\r\n  }\r\n\r\n  resize() {\r\n    this.isOpen = false;\r\n    const { position, zIndex, ..._oldProp } = this.oldProp;\r\n\r\n    this.node.style.cssText = _oldProp.cssText;\r\n\r\n    setTimeout(() => {\r\n      this.node.style.position = position;\r\n      this.node.style.zIndex = zIndex;\r\n    }, 1000);\r\n  }\r\n\r\n  animeted() {\r\n    if (this.startCB) this.startCB(this);\r\n    const target = this.node;\r\n    const w = parseFloat(getPV(target, \"width\"));\r\n    const h = parseFloat(getPV(target, \"height\"));\r\n\r\n    this.oldProp.cssText = target.style.cssText;\r\n\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n\r\n    target.style.position = \"relative\";\r\n    target.style.zIndex = PreviewNode.zIndex.toString();\r\n    let x = width / 2 - w / 2 - target.offsetLeft + window.scrollX;\r\n    let y = height / 2 - h / 2 - target.offsetTop + window.scrollY;\r\n\r\n    // 避免[transform]属性的冲突\r\n    const { transform, ..._toStyle } = PreviewSelect.toStyle;\r\n\r\n    target.style.cssText += _toStyle.cssText;\r\n\r\n    target.style.transform = `translate(${x}px , ${y}px )` + transform;\r\n\r\n    this.isOpen = true;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}